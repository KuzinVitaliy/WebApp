<!DOCTYPE html>
<html>

<head>
    <title>Проект "Комменты"</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="styles.css" />
</head>

<body>
    <div class="container">
        <ul class="comments" id="posts">
            <li class="comment">
                <div class="comment-header">
                    <div>Глеб Фокин</div>
                    <div>12.02.22 12:18</div>
                </div>
                <div class="comment-body">
                    <div class="comment-text">
                        Это будет первый комментарий на этой странице
                    </div>
                </div>
                <div class="comment-footer">
                    <div class="likes">
                        <span class="likes-counter">3</span>
                        <button class="like-button"></button>
                    </div>
                </div>
            </li>
            <li class="comment">
                <div class="comment-header">
                    <div>Варвара Н.</div>
                    <div>13.02.22 19:22</div>
                </div>
                <div class="comment-body">
                    <div class="comment-text">
                        Мне нравится как оформлена эта страница! ❤
                    </div>
                </div>
                <div class="comment-footer">
                    <div class="likes">
                        <span class="likes-counter">75</span>
                        <button class="like-button"></button>
                    </div>
                </div>
            </li>
        </ul>
        <div class="add-form">
            <input type="text" id="username" class="add-form-name" placeholder="Введите ваше имя"
                onchange=validation() />
            <textarea type="textarea" id="usercomment" class="add-form-text" placeholder="Введите ваш коментарий"
                rows="4" onchange=validation()></textarea>
            <div class="add-form-row">
                <button class="add-form-button" id="postbutton" onclick=postmessage2()>Написать</button>
            </div>
        </div>
    </div>
</body>

<script>
    const comments = [
        {
            userName: 'Глеб Фокин',
            postDate: '12.02.22 12: 18',
            comment: 'Это будет первый комментарий на этой странице',
            likeCount: 3,
            like: false
        },
        {
            userName: 'Варвара Н.',
            postDate: '13.02.22 19:22',
            comment: 'Мне нравится как оформлена эта страница! ❤',
            likeCount: 75,
            like: true
        }
    ];

    "use strict";
    // Код писать здесь
    console.log("It works!");
    validation();

    function validation() {
        let un = document.getElementById("username");
        let uc = document.getElementById("usercomment");
        let bt = document.getElementById("postbutton");
        if (un.value.length > 0 && uc.value.length > 0)
            bt.disabled = false;
        else
            bt.disabled = true;
    }

    function RenderingDOM() {
        let postList = document.getElementById("posts");
        postList.innerHTML = "";


        for (comment of comments) {
            let comElement = CreateCommentElement(comment);
            postList.appendChild(comElement);
        }
    }
    RenderingDOM();




    //Создать  элемент-контейнер в DOM
    function CreateParentElement(elementtype, sccclass, childs) {
        let result = document.createElement(elementtype);
        result.className = sccclass;

        childs?.forEach(element => {
            result.appendChild(element);
        });
        return result;
    }

    //Создать конечный элемент в DOM
    function CreateTextElement(elementtype, sccclass, text) {
        let result = document.createElement(elementtype);
        result.className = sccclass;
        result.innerText = text;
        return result;
    }

    function CreateCommentElement(comment) {

        let lb = "like-button" + (comment.like == true ? " -active-like" : "");
        let btn = CreateTextElement("button", lb, "");
        btn.addEventListener("click", () => { ClickLike(comment); });
        //        btn.addEventListener("click", () => { ClickLike(comment); });
        //btn.addEventListener("onclick", () => { ClickLike(comment); });
        let newpost = CreateParentElement("li", "comment",
            [
                CreateParentElement("div", "comment-header",
                    [CreateTextElement("div", "", comment.userName),
                    CreateTextElement("div", "", comment.postDate)]
                ),
                CreateParentElement("div", "comment-body",
                    [CreateTextElement("div", "comment-text", comment.comment)]
                ),
                CreateParentElement("div", "comment-footer",
                    [CreateParentElement("div", "likes",
                        [CreateTextElement("div", "likes-counter", comment.likeCount),
                            btn]
                    )])
            ]);
        let y = newpost.children[1];
        newpost.children[1].children[0].addEventListener("click", () => { CommentClick(comment); });
        return newpost;
    }

    let editComment;

    function CommentClick(comment) {
        let un = document.getElementById("username");
        let uc = document.getElementById("usercomment");

        un.value = comment.userName;
        un.ariaReadOnly = true;
        uc.value = comment.comment + " > ";
        editComment = comment;
    }

    function ClickLike(comment) {
        let r = 0;
        if (comment.like) {
            comment.like = false;
            comment.likeCount--;
        } else {
            comment.like = true;
            comment.likeCount++;
        }
        RenderingDOM();
    }

    function postmessage2() {
        let un = document.getElementById("username");
        let uc = document.getElementById("usercomment");
        let date = new Date();
        let dateStr = `${date.getMonth() + 1}.${date.getMonth() + 1}.${date.getFullYear()} ${date.getHours()}: ${date.getMinutes()}`;
        if (editComment == null) {
            let newCom = {
                userName: un.value,
                postDate: dateStr,
                comment: uc.value,
                likeCount: 0,
                like: false
            };
            comments.push(newCom);
        }
        else {
            editComment.comment = uc.value;
        }

        RenderingDOM();
        un.value = "";
        uc.value = "";
        validation();
    }


</script>

</html>